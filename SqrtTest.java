import java.math.BigDecimal;
import java.math.RoundingMode;

public class SqrtTest {

    public static void main(String[] args) {
        if (args.length < 1) {
            System.out.println("Usage: java SqrtTest [int]");
            System.exit(1);
        }
        BigDecimal x = new BigDecimal(args[0]);

        BigDecimal root = Sqrt.sqrt(x);

        System.out.println(root);

    }

}

class Sqrt{

    private static int decimal_places = 10;

    public static BigDecimal sqrt(BigDecimal x) {
        return sqrt_iter(new BigDecimal("1.0"), x);
    }

    private static BigDecimal sqrt_iter(BigDecimal guess, BigDecimal x) {
        System.out.println("guess: " + guess);
        if (good_enough(guess, x)) {
            return guess;
        } else {
            return sqrt_iter(improve(guess, x), x);
        }
    }

    private static BigDecimal improve(BigDecimal guess, BigDecimal x) {
        return average(guess, x.divide(guess, decimal_places, RoundingMode.HALF_UP));    
    }
    
    private static boolean good_enough(BigDecimal guess, BigDecimal x) {
        System.out.println("guess^2: " + guess.pow(2));
        System.out.println("enough?: " + guess.pow(2).subtract(x).abs());
        return (guess.pow(2).subtract(x).abs().compareTo(new BigDecimal("0.001")) <  0);
    }

    private static BigDecimal average(BigDecimal x, BigDecimal y) {
        return x.add(y).divide(new BigDecimal(2));
    }

}

// 実行結果
/*
$ java SqrtTest 1e15
guess: 1.0
guess^2: 1.00
enough?: 999999999999999.00
guess: 500000000000000.5000000000
guess^2: 250000000000000500000000000000.25000000000000000000
enough?: 249999999999999500000000000000.25000000000000000000
guess: 250000000000001.2500000000
guess^2: 62500000000000625000000000001.56250000000000000000
enough?: 62499999999999625000000000001.56250000000000000000
guess: 125000000000002.6250000000
guess^2: 15625000000000656250000000006.89062500000000000000
enough?: 15624999999999656250000000006.89062500000000000000
guess: 62500000000005.3125000000
guess^2: 3906250000000664062500000028.22265625000000000000
enough?: 3906249999999664062500000028.22265625000000000000
guess: 31250000000010.6562500000
guess^2: 976562500000666015625000113.55566406250000000000
enough?: 976562499999666015625000113.55566406250000000000
guess: 15625000000021.3281250000
guess^2: 244140625000666503906250454.88891601562500000000
enough?: 244140624999666503906250454.88891601562500000000
guess: 7812500000042.66406249995
guess^2: 61035156250666625976563538.9722289996398437500025
enough?: 61035156249666625976563538.9722289996398437500025
guess: 3906250000085.332031249625
guess^2: 15258789063166656494144976.868057186977539062640625
enough?: 15258789062166656494144976.868057186977539062640625
guess: 1953125000170.6660156220125
guess^2: 3814697266291664123552613.21701329301469727455015625
enough?: 3814697265291664123552613.21701329301469727455015625
guess: 976562500341.33300778865625
guess^2: 953674317072916030953727.4604873008682256661806640625
enough?: 953674316072916030953727.4604873008682256661806640625
guess: 488281250682.666503715378125
guess^2: 238418579768229008000582.505490290875344659611728515625
enough?: 238418578768229008000582.505490290875344659611728515625
guess: 244140626365.3332504260390625
guess^2: 59604645442057253048724.27070526122084166553277587890625
enough?: 59604644442057253048724.27070526122084166553277587890625
guess: 122070315230.66661375976953125
guess^2: 14901161860514317456483.8887175783859453200531158447265625
enough?: 14901160860514317456483.8887175783859453200531158447265625
guess: 61035161711.333215253934765625
guess^2: 3725290965128596141338.071730338972779088333943023681640625
enough?: 3725289965128596141338.071730338972779088333943023681640625
guess: 30517589047.6658746193173828125
guess^2: 931323241282216144187.75430167956317885480190372467041015625
enough?: 931322241282216144187.75430167956317885480190372467041015625
guess: 15258810907.82707325015869140625
guess^2: 232831310320822471310.5028099821973972717536985874176025390625
enough?: 232830310320822471310.5028099821973972717536985874176025390625
guess: 7629438221.866624209579345703125
guess^2: 58208327581279356577.368186399817013986002145349979400634765625
enough?: 58207327581279356577.368186399817013986002145349979400634765625
guess: 3814784646.5580147148896728515625
guess^2: 14552581899614757249.51776357824072709917794356405735015869140625
enough?: 14551581899614757249.51776357824072709917794356405735015869140625
guess: 1907523392.27669013294483642578125
guess^2: 3638645492082771465.9322880852518437556283604027330875396728515625
enough?: 3637645492082771465.9322880852518437556283604027330875396728515625
guess: 954023816.121787698872418212890625
guess^2: 910161441727578586.455078884816267722693559827245771884918212890625
enough?: 909161441727578586.455078884816267722693559827245771884918212890625
guess: 477536003.9917821948362091064453125
guess^2: 228040635108439420.32093299472232037983734381423331797122955322265625
enough?: 227040635108439420.32093299472232037983734381423331797122955322265625
guess: 239815043.46673400456810455322265625
guess^2: 57511255072951519.9679650107393536362911631935485638678073883056640625
enough?: 56511255072951519.9679650107393536362911631935485638678073883056640625
guess: 121992461.830418743784052276611328125
guess^2: 14882160743446174.119085269580820778489004024705500341951847076416015625
enough?: 13882160743446174.119085269580820778489004024705500341951847076416015625
guess: 65094844.8172310237920261383056640625
guess^2: 4237338821779388.67927100608202244505754756074180477298796176910400390625
enough?: 3237338821779388.67927100608202244505754756074180477298796176910400390625
guess: 40228522.21619423409601306915283203125
guess^2: 1618333999698833.0519491705857661493510802343016621307469904422760009765625
enough?: 618333999698833.0519491705857661493510802343016621307469904422760009765625
guess: 32543253.585447477848006534576416015625
guess^2: 1059063353926740.122387893719339210473139779034399907686747610569000244140625
enough?: 59063353926740.122387893719339210473139779034399907686747610569000244140625
guess: 31635794.3209387846240032672882080078125
guess^2: 1000823482316742.65695237311444573034900226996917126598418690264225006103515625
enough?: 823482316742.65695237311444573034900226996917126598418690264225006103515625
guess: 31622779.27999515296200163364410400390625
guess^2: 1000000169391290.7647744317989476233353905330265030215741717256605625152587890625
enough?: 169391290.7647744317989476233353905330265030215741717256605625152587890625
guess: 31622776.601683906731000816822052001953125
guess^2: 1000000000000007.172742185791441254679958173885058982932605431415140628814697265625
enough?: 7.172742185791441254679958173885058982932605431415140628814697265625
guess: 31622776.6016837933155004084110260009765625
guess^2: 999999999999999.99971612062471059626924619666092386438549510785378515720367431640625
enough?: 0.00028387937528940373075380333907613561450489214621484279632568359375
31622776.6016837933155004084110260009765625
*/

