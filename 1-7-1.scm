#lang racket

; 非常に値が大きい時
; 情報落ちのため処理が止まらなくなる
; どこで情報落ちが発生するか、確認するため途中経過を表示する

(define (sqrt-iter guess x)
  (print guess)  ; 途中経過
  (display "\n") ; 途中経過
  (if (good-enough? guess x)
          guess
          (sqrt-iter (improve guess x)
                     x)))
(define (improve guess x)
  (average guess (/ x guess))
  )

(define (average x y)
  (/ (+ x y) 2))

(define (good-enough? guess x)
  (display "ge: ")                   ; 途中経過
  (print (abs (- (square guess) x))) ; 途中経過
  (display "\n")                     ; 途中経過
  (< (abs (- (square guess) x)) 000.1)
  )

(define (sqrt2 x)
  (sqrt-iter 1.0 x))

(define (square x) (* x x))

; 実行
(sqrt2 1e+015)

; 1.0
; ; ge: 999999999999999.0
; ; 500000000000000.5
; ; ge: 2.499999999999995e+029
; ; 250000000000001.25
; ; ge: 6.249999999999962e+028
; ; 125000000000002.62
; ; ge: 1.5624999999999655e+028
; ; 62500000000005.31
; ; ge: 3.906249999999664e+027
; ; 31250000000010.656
; ; ge: 9.76562499999666e+026
; ; 15625000000021.328
; ; ge: 2.441406249996665e+026
; ; 7812500000042.664
; ; ge: 6.103515624966663e+025
; ; 3906250000085.332
; ; ge: 1.5258789062166657e+025
; ; 1953125000170.666
; ; ge: 3.8146972652916644e+024
; ; 976562500341.333
; ; ge: 9.53674316072916e+023
; ; 488281250682.6665
; ; ge: 2.3841857876822902e+023
; ; 244140626365.33325
; ; ge: 5.960464444205725e+022
; ; 122070315230.66661
; ; ge: 1.4901160860514318e+022
; ; 61035161711.33321
; ; ge: 3.725289965128596e+021
; ; 30517589047.665874
; ; ge: 9.313222412822162e+020
; ; 15258810907.827074
; ; ge: 2.328303103208225e+020
; ; 7629438221.866625
; ; ge: 5.820732758127936e+019
; ; 3814784646.558015
; ; ge: 1.4551581899614759e+019
; ; 1907523392.2766902
; ; ge: 3.637645492082772e+018
; ; 954023816.1217878
; ; ge: 9.091614417275788e+017
; ; 477536003.99178225
; ; ge: 2.2704063510843946e+017
; ; 239815043.46673402
; ; ge: 5.651125507295153e+016
; ; 121992461.83041875
; ; ge: 13882160743446176.0
; ; 65094844.81723103
; ; ge: 3237338821779389.5
; ; 40228522.216194235
; ; ge: 618333999698833.0
; ; 32543253.585447475
; ; ge: 59063353926740.0
; ; 31635794.320938785
; ; ge: 823482316742.625
; ; 31622779.27999515
; ; ge: 169391290.625
; ; 31622776.601683907
; ; ge: 7.25
; ; 31622776.601683795
; ; ge: 0.125
; ; 31622776.601683795
; ; ge: 0.125
; ; 31622776.601683795
; ; ge: 0.125
; ; 31622776.601683795
; ; ge: 0.125
; 以下ループ

; 
