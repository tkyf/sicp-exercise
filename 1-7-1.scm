; 非常に値が大きい時
; imporoveの時の除算で丸め誤差が出てる？
; 途中経過を表示する。

#lang racket

(define (average x y)
    (/ (+ x y) 2))

(define (square x) (* x x))


(define (sqrt-iter guess x)
    (print guess)  ; 途中経過
      (display "\n") ; 途中経過
        (if (good-enough? guess x)
                    guess
                              (sqrt-iter (improve guess x)
                                                              x)))

(define (improve guess x)
    (display "/ x guess:")
      (print (/ x guess))
        (display "\n")
          (average guess (/ x guess))
            )


(define (good-enough? guess x)
    (display "enough?: ")                   ; 途中経過
      (print (abs (- (square guess) x))) ; 途中経過
        (display "\n")                     ; 途中経過
          (< (abs (- (square guess) x)) 0.001)
            )

(define (sqrt2 x)
    (sqrt-iter 1.0 x))

; 実行
(sqrt2 1e+015)

; 1.0
; enough?: 999999999999999.0
; / x guess:1e+015
; 500000000000000.5
; enough?: 2.499999999999995e+029
; / x guess:1.999999999999998
; 250000000000001.25
; enough?: 6.249999999999962e+028
; / x guess:3.99999999999998
; 125000000000002.62
; enough?: 1.5624999999999655e+028
; / x guess:7.999999999999832
; 62500000000005.31
; enough?: 3.906249999999664e+027
; / x guess:15.99999999999864
; 31250000000010.656
; enough?: 9.76562499999666e+026
; / x guess:31.99999999998909
; 15625000000021.328
; enough?: 2.441406249996665e+026
; / x guess:63.99999999991264
; 7812500000042.664
; enough?: 6.103515624966663e+025
; / x guess:127.999999999301
; 3906250000085.332
; enough?: 1.5258789062166657e+025
; / x guess:255.9999999944077
; 1953125000170.666
; enough?: 3.8146972652916644e+024
; / x guess:511.99999995526093
; 976562500341.333
; enough?: 9.53674316072916e+023
; / x guess:1023.9999996420864
; 488281250682.6665
; enough?: 2.3841857876822902e+023
; / x guess:2047.9999971366892
; 244140626365.33325
; enough?: 5.960464444205725e+022
; / x guess:4095.999977093509
; 122070315230.66661
; enough?: 1.4901160860514318e+022
; / x guess:8191.99981674807
; 61035161711.33321
; enough?: 3.725289965128596e+021
; / x guess:16383.998533984659
; 30517589047.665874
; enough?: 9.313222412822162e+020
; / x guess:32767.98827188102
; 15258810907.827074
; enough?: 2.328303103208225e+020
; / x guess:65535.90617516897
; 7629438221.866625
; enough?: 5.820732758127936e+019
; / x guess:131071.24940522018
; 3814784646.558015
; enough?: 1.4551581899614759e+019
; / x guess:262137.995365551
; 1907523392.2766902
; enough?: 3.637645492082772e+018
; / x guess:524239.9668852648
; 954023816.1217878
; enough?: 9.091614417275788e+017
; / x guess:1048191.8617766907
; 477536003.99178225
; enough?: 2.2704063510843946e+017
; / x guess:2094082.941685814
; 239815043.46673402
; enough?: 5.651125507295153e+016
; / x guess:4169880.1941034826
; 121992461.83041875
; enough?: 13882160743446176.0
; / x guess:8197227.804043303
; 65094844.81723103
; enough?: 3237338821779389.5
; / x guess:15362199.615157444
; 40228522.216194235
; enough?: 618333999698833.0
; / x guess:24857984.95470072
; 32543253.585447475
; enough?: 59063353926740.0
; / x guess:30728335.056430094
; 31635794.320938785
; enough?: 823482316742.625
; / x guess:31609764.23905152
; 31622779.27999515
; enough?: 169391290.625
; / x guess:31622773.923372664
; 31622776.601683907
; enough?: 7.25
; / x guess:31622776.60168368
; 31622776.601683795
; enough?: 0.125
; / x guess:31622776.60168379
; 31622776.601683795
; enough?: 0.125
;
; 以下ループ

